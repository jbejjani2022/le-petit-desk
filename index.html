<!DOCTYPE html>
<html lang="en">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-SZ7B27RFZE"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());

    gtag('config', 'G-SZ7B27RFZE');
  </script>
  
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>le petite desk</title>
  <link rel="icon" type="image/png" href="static/turtle_light/sprite_turtle0.png">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300&family=Space+Grotesk:wght@300&family=Inter:wght@300&family=Poppins:wght@200&family=Epilogue:wght@200&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/ScrollTrigger.min.js"></script>
  <style>
    :root {
      --bg: #3c2626;
      --text: #fdf6ec;
      --accent: #df7829;
      --font-family: 'Outfit', sans-serif;
      
      /* Font options for easy testing:
         'Outfit', sans-serif (Light - 300)
         'Space Grotesk', sans-serif (Light - 300)
         'Inter', sans-serif (Light - 300)
         'Poppins', sans-serif (ExtraLight - 200)
         'Epilogue', sans-serif (ExtraLight - 200)
      */
    }

    body {
      margin: 0;
      font-family: var(--font-family);
      font-weight: 300;
      background: var(--bg);
      color: var(--text);
      overflow-x: hidden;
    }

    section {
      min-height: 70vh;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      padding: 2rem;
    }

    section.landing {
      min-height: 85vh;
      position: relative;
    }

    .landing-container {
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }

    .desk-graphic {
      display: block;
      margin: 0 auto;
      max-width: 100%;
      height: auto;
    }

    section.subscribe {
      min-height: 100vh;
      align-items: center;
      justify-content: center;
      padding-bottom: 0rem;
    }

    .subscribe form {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      gap: 1rem;
    }

    h1, h2, h3, p {
      margin: 0.5rem 0;
    }

    h1 {
      font-size: 3.5rem;
    }

    h2 {
      font-size: 2.2rem;
    }

    p {
      font-size: 1.6rem;
      line-height: 1.6;
    }

    h1.title {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 10;
      margin: 0;
      pointer-events: none;
    }

    /* UPDATED: Simplified rule with fluid font size */
    h1.title span {
      position: absolute;
      display: inline-block;
      opacity: 0;
      transform: translateY(-400px);
      transform-origin: center center;
      font-weight: bold;
      font-size: clamp(1.6rem, 3.5vw, 3.5rem); /* min, preferred, max */
    }

    .mission, .upcoming, .past, .subscribe {
      opacity: 0;
      transform: translateY(100px);
      will-change: transform, opacity; /* <-- ADDED FOR PERFORMANCE */
    }

    .mission p {
      opacity: 0;
      transform: translateY(80px);
      will-change: transform, opacity; /* <-- ADDED FOR PERFORMANCE */
    }

    .subscribe form {
      opacity: 0;
      transform: translateY(80px);
      will-change: transform, opacity; /* <-- ADDED FOR PERFORMANCE */
    }

    .event {
      margin: 1rem 0;
      font-size: 1.7rem;
      opacity: 0;
      transform: translateY(60px);
      will-change: transform, opacity; /* <-- ADDED FOR PERFORMANCE */
    }

    .event.upcoming-title, .event.past-title, .event.mission-title {
      color: var(--accent);
      font-weight: bold;
      font-size: 2.2rem;
      margin-bottom: 2rem;
    }

    input[type="email"] {
      background: transparent;
      border: none;
      border-bottom: 2px solid var(--text);
      color: var(--text);
      font-family: var(--font-family);
      font-weight: 300;
      font-size: 1.3rem;
      text-align: center;
      outline: none;
      padding: 1rem;
      width: 350px;
      transition: border-bottom-color 0.3s ease;
      border-radius: 0;
      -webkit-appearance: none;
      -moz-appearance: none;
      appearance: none;
      box-shadow: none;
      background-clip: padding-box;
      caret-color: var(--text);
    }

    input[type="email"]:focus {
      border-bottom-color: var(--accent);
      box-shadow: none;
    }

    input[type="email"]::placeholder {
      color: rgba(253, 246, 236, 0.5);
    }

    /* Remove autofill background and preserve underline-only style */
    input[type="email"]:-webkit-autofill {
      -webkit-box-shadow: 0 0 0px 1000px transparent inset;
      box-shadow: 0 0 0px 1000px transparent inset;
      -webkit-text-fill-color: var(--text);
      border-bottom-color: var(--text);
      transition: background-color 5000s ease-in-out 0s;
    }
    input[type="email"]:-webkit-autofill:focus {
      border-bottom-color: var(--accent);
      -webkit-text-fill-color: var(--text);
    }

    .subscribe-text {
      font-size: 1.2rem;
      margin-top: 1rem;
      color: rgba(253, 246, 236, 0.7);
    }

    .error-message {
      color: #ff6b6b;
      font-size: 1rem;
      margin-top: 0.5rem;
      opacity: 0;
      transition: opacity 0.3s ease;
      font-family: var(--font-family);
      font-weight: 300;
    }

    .error-message.show {
      opacity: 1;
    }

    .jam-with-us {
      font-size: 1.2rem;
      margin-top: 2rem;
      color: rgba(253, 246, 236, 0.7);
      font-family: var(--font-family);
      font-weight: 300;
    }

    .jam-with-us a {
      color: var(--text);
      text-decoration: none;
      transition: color 0.3s ease;
    }

    .jam-with-us a:hover {
      color: var(--accent);
    }

    /* Instagram Icon */
    .instagram-icon {
      position: fixed;
      top: 2rem;
      left: 2rem;
      z-index: 100;
      width: 28px;
      height: 28px;
      fill: var(--text);
      transition: fill 0.3s ease, transform 0.2s ease;
      cursor: pointer;
    }

    .instagram-icon:hover {
      fill: var(--accent);
      transform: scale(1.1);
    }

    /* Dot Navigation */
    .dot-nav {
      position: fixed;
      right: 2rem;
      top: 50%;
      transform: translateY(-50%) scale(0.85);
      transform-origin: right center;
      z-index: 100;
      display: flex;
      flex-direction: column;
      gap: 0.8rem;
      transition: transform 0.25s ease, opacity 0.25s ease;
      opacity: 0.7;
    }

    .dot-nav.expanded {
      transform: translateY(-50%) scale(1.1);
      opacity: 1;
    }

    .dot-nav .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: rgba(253, 246, 236, 0.3);
      border: 2px solid rgba(253, 246, 236, 0.5);
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
      outline: none;
      -webkit-tap-highlight-color: transparent;
    }

    .dot-nav .dot:focus,
    .dot-nav .dot:focus-visible,
    .dot-nav .dot:active {
      outline: none;
      box-shadow: none;
    }

    .dot-nav .dot::before {
      content: '';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--accent);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .dot-nav .dot.active {
      background: rgba(233, 164, 111, 0.2);
      border-color: var(--accent);
      transform: scale(1.7);
    }

    .dot-nav .dot.active:hover {
      transform: scale(1.7);
    }

    .dot-nav .dot.active::before {
      opacity: 1;
    }

    .dot-nav .dot:hover {
      background: rgba(253, 246, 236, 0.4);
      border-color: var(--accent);
      transform: scale(1.35);
    }
    
    @media (hover: none) {
      .dot-nav .dot:hover {
        background: rgba(253, 246, 236, 0.3);
        border-color: rgba(253, 246, 236, 0.5);
        transform: none;
      }
      .dot-nav .dot:focus,
      .dot-nav .dot:focus-visible,
      .dot-nav .dot:active {
        outline: none;
        box-shadow: none;
      }
      .dot-nav .dot.active,
      .dot-nav .dot.active:hover,
      .dot-nav .dot.active:focus,
      .dot-nav .dot.active:active {
        background: rgba(233, 164, 111, 0.2);
        border-color: var(--accent);
        transform: scale(1.7);
      }
    }

    .event.upcoming-title, .event.past-title, .event.mission-title {
      color: var(--accent) !important;
    }

    :root {
      --content-max: 1000px;
      --rail-safe-space: 6rem;
    }

    section:not(.landing) > div {
      width: min(var(--content-max), calc(100vw - var(--rail-safe-space)));
      margin: 0 auto;
      padding-left: clamp(1rem, 3vw, 2rem);
      padding-right: clamp(1rem, 3vw, 2rem);
    }

    section.subscribe form {
      width: min(var(--content-max), calc(100vw - var(--rail-safe-space)));
      margin-left: auto;
      margin-right: auto;
      padding-left: clamp(1rem, 3vw, 2rem);
      padding-right: clamp(1rem, 3vw, 2rem);
    }

    /* Footer */
    .footer {
      background: #281c1c; /* darker brown than --bg */
      color: var(--text);
      text-align: center;
      padding: 2rem 0 1.1rem;
      margin-top: 0rem;
    }

    .footer > div {
      width: min(var(--content-max), calc(100vw - var(--rail-safe-space)));
      margin: 0 auto;
      padding-left: clamp(1rem, 3vw, 2rem);
      padding-right: clamp(1rem, 3vw, 2rem);
    }

    .footer-title {
      font-size: 1.6rem;
      font-weight: bold;
      margin-bottom: 0.5rem;
    }

    .footer-subtitle {
      font-size: 1.1rem;
      color: rgba(253, 246, 236, 0.9);
    }

    .footer a {
      color: var(--text);
      text-decoration: none;
      border-bottom: 1px solid rgba(253, 246, 236, 0.35);
      transition: color 0.3s ease, border-bottom-color 0.3s ease;
    }

    .footer a:hover {
      color: var(--accent);
      border-bottom-color: var(--accent);
    }

    .footer-turtle {
      display: block;
      margin: 0.9rem auto 0;
      width: 52px;
      height: 52px;
    }

    /* Turtle Animation */
    .turtle-container {
      position: relative;
      width: 100%;
      height: 110px;
      margin-top: 2rem;
      overflow: hidden;
    }

    .turtle {
      position: absolute;
      width: 90px;
      height: 90px;
      background-image: url('static/turtle_light/sprite_turtle0.png');
      background-size: contain;
      background-repeat: no-repeat;
      background-position: center;
      top: 10px;
      opacity: 0;
      left: -60px;
    }

    .turtle.animate {
      animation: walkAcrossWithDelay 30s linear infinite, walkSprite 1.4s steps(2) infinite;
    }

    @keyframes walkAcrossWithDelay {
      0% { left: -60px; opacity: 0; }
      5% { left: -60px; opacity: 0; }
      8% { left: -60px; opacity: 1; }
      85% { left: calc(100% + 60px); opacity: 1; }
      88% { left: calc(100% + 60px); opacity: 0; }
      100% { left: calc(100% + 60px); opacity: 0; }
    }

    @keyframes walkSprite {
      0% { background-image: url('static/turtle_light/sprite_turtle0.png'); }
      50% { background-image: url('static/turtle_light/sprite_turtle1.png'); }
    }



    /* Mobile responsiveness */
    @media (max-width: 768px) {
      :root { --rail-safe-space: 4.5rem; }
      
      .instagram-icon {
        top: 1.5rem;
        left: 1.5rem;
        width: 28px;
        height: 28px;
      }
      
      .dot-nav {
        transform: translateY(-50%) scale(0.75);
        right: 1rem;
        gap: 1rem;
        opacity: 0.85;
      }
      .dot-nav .dot { width: 9px; height: 9px; }
      .dot-nav .dot.active { transform: scale(1.8); }
      .dot-nav .dot.active:hover { transform: scale(1.9); }
      .dot-nav .dot:hover { transform: scale(1.35); }
      
      h1 { font-size: 2.2rem; }
      h2 { font-size: 1.6rem; }
      p { font-size: 1.2rem; }
      .event { font-size: 1.3rem; }
      .event.upcoming-title, .event.past-title, .event.mission-title { font-size: 1.7rem; }
      
      input[type="email"] {
        width: 280px;
        max-width: 72vw;
        font-size: 1.5rem;
      }

      .jam-with-us {
        font-size: 1.1rem;
        margin-top: 1.5rem;
      }
      
      section { padding: 1rem; min-height: 60vh; }

      section.landing {
        min-height: 100dvh;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        max-width: 100%;
        overflow-x: hidden;
      }

      .landing-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        max-width: 100%;
        overflow-x: hidden;
      }

      .desk-graphic {
        width: 150%;
        max-width: none;
        height: auto;
        position: relative;
        left: 50%;
        transform: translateX(-50%);
        display: block;
        object-fit: contain;
        object-position: center;
      }

      section.subscribe { min-height: 100vh; }

      /* Turtle responsive adjustments */
      .turtle-container { height: 95px; margin-top: 1.5rem; }
      .turtle { width: 72px; height: 72px; }
      .turtle.animate { animation: walkAcrossWithDelay 24s linear infinite, walkSprite 1.4s steps(2) infinite; }
    }

    @media (max-width: 480px) {
      :root { --rail-safe-space: 4rem; }
      
      .instagram-icon {
        top: 1rem;
        left: 1rem;
        width: 24px;
        height: 24px;
      }
      
      h1 { font-size: 1.8rem; }
      .event.upcoming-title, .event.past-title, .event.mission-title { font-size: 1.4rem; }
      
      input[type="email"] {
        width: 240px;
        max-width: 70vw;
        font-size: 1.2rem;
      }

      .jam-with-us {
        font-size: 1.1rem;
        margin-top: 1.2rem;
      }

      section { min-height: 55vh; padding: 0; }

      section.landing {
        min-height: 100dvh;
        display: flex;
        align-items: center;
        justify-content: center;
        width: 100%;
        max-width: 100%;
        overflow-x: hidden;
      }

      .landing-container {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        width: 100%;
        max-width: 100%;
        overflow-x: hidden;
      }

      .desk-graphic {
        width: 180%;
        max-width: none;
        height: auto;
        position: relative;
        left: 50%;
        transform: translateX(-50%);
        display: block;
        object-fit: contain;
        object-position: center;
      }

      section.subscribe { min-height: 100vh; }

      .dot-nav {
        display: flex;
        right: 0.8rem;
        gap: 1.1rem;
        transform: translateY(-50%) scale(0.7);
        opacity: 0.9;
      }

      .dot-nav .dot { width: 9px; height: 9px; }
      .dot-nav .dot.active { transform: scale(1.85); }
      .dot-nav .dot.active:hover { transform: scale(2.0); }
      .dot-nav .dot:hover { transform: scale(1.45); }

      /* Turtle responsive adjustments for small mobile */
      .turtle-container { height: 80px; margin-top: 1rem; }
      .turtle { width: 60px; height: 60px; }
      .turtle.animate { animation: walkAcrossWithDelay 20s linear infinite, walkSprite 1.4s steps(2) infinite; }
    }
  </style>
</head>
<body>

  <a href="https://www.instagram.com/lepetitedesk/" target="_blank" rel="noopener noreferrer">
    <svg class="instagram-icon" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
      <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
    </svg>
  </a>

  <section class="landing">
    <div class="landing-container">
      <img src="static/desk.svg" alt="Le Petite Desk" class="desk-graphic" width="1600" height="1600" />
      <h1 class="title">
        <span>le</span>
        <span>petite</span>
        <span>desk</span>
      </h1>
    </div>
  </section>

  <section class="mission">
    <div>
      <div class="event mission-title">our dorm turned studio</div>
      <p>we gather musicians in the most honest venue we know—our living room</p>
      <p>home to a petite desk with big sound</p>
      <p>no pressure, just music that matters</p>
      <p>made in good company</p>
      <div class="turtle-container">
        <div class="turtle"></div>
      </div>
    </div>
  </section>

  <section class="upcoming">
    <div>
      <div class="event upcoming-title">fri, sep 19</div>
      <div class="event">le petite desk opening night</div>
    </div>
  </section>

  <section class="past">
    <div>
      <div class="event past-title">previously</div>
      <div class="event">nothing...yet</div>
    </div>
  </section>

  <section class="subscribe">
    <form id="subscribeForm" novalidate>
      <input type="email" id="emailInput" name="email" placeholder="your@email.com" required />
      <div class="subscribe-text">stay tuned to events at le petite desk</div>
      <div class="error-message" id="errorMessage">invalid email address</div>
      <div class="jam-with-us">want to jam with us?<br>have ideas for a concert?<br><br>let us know at <a href="mailto:lepetitedesk@gmail.com">lepetitedesk@gmail.com</a></div>
    </form>
  </section>

  <footer class="footer">
    <div>
      <div class="footer-title">le petite desk</div>
      <div class="footer-subtitle">brought to you by the team behind the <a href="https://goldenarmtheater.com" target="_blank" rel="noopener noreferrer">golden arm theater</a></div>
      <img class="footer-turtle" src="static/turtle_light/sprite_turtle0.png" alt="turtle" width="32" height="32" />
    </div>
  </footer>

  <nav class="dot-nav">
    <div class="dot" data-section="landing"></div>
    <div class="dot" data-section="mission"></div>
    <div class="dot" data-section="upcoming"></div>
    <div class="dot" data-section="past"></div>
    <div class="dot" data-section="subscribe"></div>
  </nav>

  <script>
    gsap.registerPlugin(ScrollTrigger);
    
    // Replace with your deployed Google Apps Script Web App URL (ends with /exec)
    const WEB_APP_URL = 'https://script.google.com/macros/s/AKfycbzIjuet4gxxD3LvkvByzy9Sxb_cWK-Nk7c0SEVxO_HuycgEMe4XKM0TDaWm35RIhsGXvw/exec';

    // ✨ NEW: DYNAMIC WORD POSITIONING LOGIC
    const deskGraphic = document.querySelector('.desk-graphic');
    const titleContainer = document.querySelector('h1.title');
    const words = gsap.utils.toArray(".title span");

    // Define the target positions as percentages OF THE IMAGE ITSELF.
    // Tweak these values slightly if needed to get the perfect placement.
    const wordPositions = [
      { x: 0.37, y: 0.4325 }, // le
      { x: 0.455, y: 0.545 }, // petite
      { x: 0.57, y: 0.595 }  // desk
    ];

    function updateWordPositions() {
      // Get the current size and position of the desk image and the title container
      const deskRect = deskGraphic.getBoundingClientRect();
      const titleRect = titleContainer.getBoundingClientRect();

      words.forEach((word, index) => {
        const pos = wordPositions[index];
        
        // Calculate the absolute target coordinates on the page
        const targetX = deskRect.left + (deskRect.width * pos.x);
        const targetY = deskRect.top + (deskRect.height * pos.y);

        // Convert the absolute coordinates to be relative to the title container,
        // which is the positioning parent of the words.
        const finalLeft = targetX - titleRect.left;
        const finalTop = targetY - titleRect.top;

        // Use GSAP to instantly set the position.
        // This sets the final destination for the drop-in animation.
        gsap.set(word, { left: finalLeft, top: finalTop });
      });
    }

    // Run the positioning logic when the page loads and on window resize.
    // We 'debounce' the resize event to avoid performance issues.
    let resizeTimer;
    window.addEventListener('resize', () => {
      clearTimeout(resizeTimer);
      resizeTimer = setTimeout(updateWordPositions, 100);
    });

    // Ensure image is loaded before we calculate, then run initial positioning
    deskGraphic.addEventListener('load', updateWordPositions);
    // Fallback for cached images that might not fire a 'load' event
    if (deskGraphic.complete) {
      updateWordPositions();
    }
    // END NEW LOGIC

    // Title animation - This remains the same!
    // It will now animate to the dynamically calculated positions.
    words.forEach((word, index) => {
      const rotations = [-4, 2, 0];
      const delays = [0.3, 0.7, 1.1];
      const bounceHeights = [25, 30, 28];
      
      gsap.timeline()
        .to(word, {
          y: 0,
          opacity: 1,
          rotation: rotations[index],
          duration: 0.8,
          ease: "power3.in",
          delay: delays[index]
        })
        .to(word, { y: -bounceHeights[index], duration: 0.15, ease: "power2.out" })
        .to(word, { y: 0, duration: 0.25, ease: "power2.in" })
        .to(word, { y: -bounceHeights[index] * 0.6, duration: 0.12, ease: "power2.out" })
        .to(word, { y: 0, duration: 0.2, ease: "power2.in" })
        .to(word, { y: -bounceHeights[index] * 0.25, duration: 0.1, ease: "power2.out" })
        .to(word, { y: 0, duration: 0.15, ease: "power2.in" });
    });

    // Scroll-triggered fade-in-up animations for sections
    [".mission", ".upcoming", ".past", ".subscribe"].forEach(cls => {
      gsap.to(cls, {
        opacity: 1,
        y: 0,
        duration: 1.2,
        ease: "power3.out",
        scrollTrigger: {
          trigger: cls,
          start: "top 85%",
          toggleActions: "play none none none"
        }
      });
    });

    // Fade-in-up animations for individual events
    gsap.utils.toArray(".event").forEach((event, index) => {
      gsap.to(event, {
        opacity: 1,
        y: 0,
        duration: 1,
        ease: "power3.out",
        delay: index * 0.15,
        scrollTrigger: {
          trigger: event.closest('section'),
          start: "top 80%",
          toggleActions: "play none none none"
        }
      });
    });

    // Fade-in-up for mission text
    gsap.to(".mission p", {
      opacity: 1,
      y: 0,
      duration: 1.2,
      ease: "power3.out",
      scrollTrigger: {
        trigger: ".mission",
        start: "top 85%",
        toggleActions: "play none none none"
      }
    });

    // Fade-in-up for subscribe form
    gsap.to(".subscribe form", {
      opacity: 1,
      y: 0,
      duration: 1.2,
      ease: "power3.out",
      scrollTrigger: {
        trigger: ".subscribe",
        start: "top 85%",
        toggleActions: "play none none none"
      }
    });

    // Email validation
    const emailInput = document.getElementById('emailInput');
    const errorMessage = document.getElementById('errorMessage');
    const subscribeForm = document.getElementById('subscribeForm');

    function validateEmail(email) {
      const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      return emailRegex.test(email);
    }

    function showError() {
      errorMessage.classList.add('show');
    }

    function hideError() {
      errorMessage.classList.remove('show');
    }

    subscribeForm.addEventListener('submit', function(e) {
      e.preventDefault();
      const email = emailInput.value.trim();
      
      if (!email || !validateEmail(email)) {
        showError();
      } else {
        hideError();
        const data = new FormData();
        data.append('email', email);
        
        if (WEB_APP_URL && WEB_APP_URL.startsWith('https')) {
          fetch(WEB_APP_URL, {
            method: 'POST',
            body: new URLSearchParams({ email }),
            mode: 'no-cors'
          });
        }
        
        emailInput.value = '';
        const subscribeText = document.querySelector('.subscribe-text');
        if (subscribeText) {
          subscribeText.textContent = 'thanks! you\'re on the list';
        }
      }
    });

    emailInput.addEventListener('input', function() {
      hideError();
    });

    // ✅ NEW: OPTIMIZED DOT NAVIGATION LOGIC
    const dots = document.querySelectorAll('.dot-nav .dot');
    const sections = document.querySelectorAll('section');

    dots.forEach((dot, index) => {
      const section = sections[index];
      if (!section) return;

      // Use ScrollTrigger to efficiently toggle the active class
      ScrollTrigger.create({
        trigger: section,
        start: "top center",
        end: "bottom center",
        onToggle: self => {
          if (self.isActive) {
            dots.forEach(d => d.classList.remove('active'));
            dot.classList.add('active');
          }
        }
      });

      // Click-to-scroll logic
      dot.addEventListener('click', () => {
        if (index === sections.length - 1) {
          const footer = document.querySelector('.footer');
          if (footer) {
            footer.scrollIntoView({
              behavior: 'smooth',
              block: 'center',
              inline: 'center'
            });
            return;
          }
        }
        section.scrollIntoView({
          behavior: 'smooth',
          block: 'center',
          inline: 'center'
        });
      });
    });

    // ✅ NEW: OPTIMIZED NAV EXPANSION LOGIC
    const dotNav = document.querySelector('.dot-nav');
    let shrinkTimeout;

    ScrollTrigger.create({
      trigger: "body",
      onScrollStart: () => {
        if (window.matchMedia('(min-width: 769px)').matches) {
            clearTimeout(shrinkTimeout);
            dotNav.classList.add('expanded');
        }
      },
      onScrollEnd: () => {
        if (window.matchMedia('(min-width: 769px)').matches) {
            shrinkTimeout = setTimeout(() => {
                dotNav.classList.remove('expanded');
            }, 1200);
        }
      }
    });

    // Keep the hover effects, they are not a performance issue
    dotNav.addEventListener('mouseenter', () => {
      if (window.matchMedia('(min-width: 769px)').matches) {
        dotNav.classList.add('expanded');
      }
    });
    dotNav.addEventListener('mouseleave', () => {
      if (window.matchMedia('(min-width: 769px)').matches) {
        dotNav.classList.remove('expanded');
      }
    });

    // Turtle animation trigger
    function startTurtleAnimation() {
      const turtle = document.querySelector('.turtle');
      if (turtle && !turtle.classList.contains('animate')) {
        turtle.classList.add('animate');
      }
    }

    ScrollTrigger.create({
      trigger: ".mission",
      start: "top 80%",
      onEnter: startTurtleAnimation,
      once: true
    });
  </script>
</body>
</html>